FROM        registry.gitlab.steamos.cloud/steamrt/steamrt4/sdk:latest-container-runtime-depot
LABEL       author="Vauff"
LABEL       org.opencontainers.image.description SteamRT4 Debug image for Pterodactyl CSGO/CS2/Source engine servers. 
LABEL       org.opencontainers.image.source="https://github.com/Vauff/CS2-Pterodactyl"

# Prep OS
RUN         mkdir -p /etc/sudoers.d && echo "%sudo ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/flatdeb && chmod 0440 /etc/sudoers.d/flatdeb
ENV         DEBIAN_FRONTEND=noninteractive
RUN         apt update && apt install -y iproute2 valgrind bind9-dnsutils && apt-get clean
RUN         wget https://apt.llvm.org/llvm.sh && chmod +x llvm.sh && sudo ./llvm.sh 21
# this was needed to fix valgrind for some reason??
RUN	        sudo apt install -y --reinstall libc6-dbg
USER        container
ENV         USER=container HOME=/home/container
WORKDIR     /home/container

# EP
COPY        ./docker/entrypoint.sh /entrypoint.sh
CMD         [ "/bin/bash", "/entrypoint.sh" ]

