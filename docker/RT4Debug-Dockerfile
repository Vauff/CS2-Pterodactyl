FROM        registry.gitlab.steamos.cloud/steamrt/steamrt4/sdk:latest-container-runtime-depot
LABEL       author="Vauff"
LABEL       org.opencontainers.image.description SteamRT4 Debug image for Pterodactyl CSGO/CS2/Source engine servers. 
LABEL       org.opencontainers.image.source="https://github.com/Vauff/CS2-Pterodactyl"

# Prep OS
RUN         mkdir -p /etc/sudoers.d && echo "%sudo ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/flatdeb && chmod 0440 /etc/sudoers.d/flatdeb
ENV         DEBIAN_FRONTEND=noninteractive
RUN         echo "deb http://apt.llvm.org/trixie/ llvm-toolchain-trixie main" >> /etc/apt/sources.list.d/llvm.list
RUN         echo "deb-src http://apt.llvm.org/trixie/ llvm-toolchain-trixie main" >> /etc/apt/sources.list.d/llvm.list
RUN         wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo gpg --dearmor -o /usr/share/keyrings/llvm-toolchain-trixie.gpg
# debian refuses to recognize the llvm gpg key..
RUN         apt update --allow-unauthenticated && apt install --allow-unauthenticated -y iproute2 valgrind clang-tools-21 bind9-dnsutils && apt-get clean
# this was needed to fix valgrind for some reason??
RUN	        sudo apt install -y --reinstall libc6-dbg
USER        container
ENV         USER=container HOME=/home/container
WORKDIR     /home/container

# EP
COPY        ./docker/entrypoint.sh /entrypoint.sh
CMD         [ "/bin/bash", "/entrypoint.sh" ]

